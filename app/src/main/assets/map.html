<!DOCTYPE html>
<html>
<head>
    <title>Simple Map with OpenCage Geocoding</title>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCLiQTQyMVffR1ZJk2Rd2YZBOZ3ITpgUDc"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <style>
        #map { height: 500px; width: 100%; }
        #address { margin-top: 10px; font-size: 17px; font-weight: 500; display: flex; align-items: center; }
        #address i {
            margin-right: 8px;
            color: #e74c3c;
            font-size: 17px; /* Đặt kích thước icon bằng với font-size của text */
            line-height: 17px; /* Đảm bảo chiều cao dòng của icon khớp với text */
            vertical-align: middle; /* Căn chỉnh dọc giữa */
        }
        #status-info { margin-top: 10px; font-size: 17px; font-weight: bold; display: flex; align-items: center; }
        #status-info i { margin-right: 8px; color: #2c3e50; }
    </style>
    <script>
        let map, marker;

        function initMap() {
            const location = { lat: 16.076868, lng: 108.213356 }; // Tọa độ tại Đà Nẵng
            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 18,
                center: location
            });
            marker = new google.maps.Marker({
                position: location,
                map: map
            });

            // Gọi OpenCage API để lấy địa chỉ khởi tạo
            GetToaDoChiTiet(location.lng, location.lat);
        }

        function updateMapPosition(longitude, latitude) {
            const newPosition = { lat: latitude, lng: longitude };
            marker.setPosition(newPosition);
            map.setCenter(newPosition);
            GetToaDoChiTiet(longitude, latitude);
        }

        function GetToaDoChiTiet(longitude, latitude) {
            const apiKey = '94fc2b942c1a41b48def363d57e5e1a2';
            const url = `https://api.opencagedata.com/geocode/v1/json?q=${latitude}+${longitude}&key=${apiKey}&language=vi&pretty=1`;

            fetch(url)
                .then(response => response.json())
                .then(data => {
                    if (data.results && data.results.length > 0) {
                        const address = data.results[0].formatted;
                        document.getElementById('address').innerHTML = '<i class="fas fa-location-dot"></i> Địa chỉ: ' + address;
                    } else {
                        document.getElementById('address').innerHTML = '<i class="fas fa-location-dot"></i> Không tìm thấy địa chỉ';
                    }
                })
                .catch(error => {
                    console.error('Lỗi khi gọi OpenCage API:', error);
                    document.getElementById('address').innerHTML = '<i class="fas fa-location-dot"></i> Lỗi khi lấy địa chỉ';
                });
        }
    </script>
</head>
<body onload="initMap()">
<div id="map"></div>
<div id="address" style="margin-top:15px; font-size:17px; font-weight:500; display:flex;align-items: start;">

    Đang tải địa chỉ...</div>
<div id="status-info" style="margin-top:10px; font-size:17px; font-weight: bold;">
    Trạng thái: Chưa xác định
</div>
</body>
</html>